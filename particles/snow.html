<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Particle Engine (Three.js)</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
  </head>
  <body>
    <script src="js/Three.js"></script>
    <!-- <script src="js/Detector.js"></script>
    <script src="js/THREEx.WindowResize.js"></script>

    <script src="js/ParticleEngine.js"></script>
    <script src="js/ParticleEngineExamples.js"></script> -->

    <!-- ------------------------------------------------------------ -->

    <div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
    <script>
      // standard global variables
      var container, scene, camera, renderer;
      var clock = new THREE.Clock();
      // custom global variables
      var cube;

      init();
      animate();

      // FUNCTIONS
      function init() {
        // SCENE
        scene = new THREE.Scene();
        // CAMERA
        var SCREEN_WIDTH = window.innerWidth,
          SCREEN_HEIGHT = window.innerHeight;
        var VIEW_ANGLE = 45,
          ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT,
          NEAR = 2,
          FAR = 5000;
        camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
        scene.add(camera);
        camera.position.set(0, 200, 400);
        camera.lookAt(scene.position);
        // RENDERER
        if (Detector.webgl)
          renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        else renderer = new THREE.CanvasRenderer();
        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        container = document.getElementById("ThreeJS");
        container.appendChild(renderer.domElement);
        // EVENTS
        THREEx.WindowResize(renderer, camera);

        ////////////
        // CUSTOM //
        ////////////

        this.engine = new ParticleEngine();
        engine.setValues(Examples.snow);
        engine.initialize();
      }

      function animate() {
        requestAnimationFrame(animate);
        render();
        update();
      }

      function restartEngine(parameters) {
        resetCamera();

        engine.destroy();
        engine = new ParticleEngine();
        engine.setValues(parameters);
        engine.initialize();
      }

      function resetCamera() {
        // CAMERA
        var SCREEN_WIDTH = window.innerWidth,
          SCREEN_HEIGHT = window.innerHeight;
        var VIEW_ANGLE = 45,
          ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT,
          NEAR = 0.1,
          FAR = 20000;
        camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
        //camera.up = new THREE.Vector3( 0, 0, 1 );
        camera.position.set(0, 200, 400);
        camera.lookAt(scene.position);
        scene.add(camera);

        THREEx.WindowResize(renderer, camera);
      }

      function update() {
        var dt = clock.getDelta();
        engine.update(dt * 0.5);
      }

      function render() {
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
